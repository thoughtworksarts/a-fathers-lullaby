language: node_js
node_js:
- stable
addons:
  apt:
    packages:
    - libgconf-2-4
cache:
  npm: true
  directories:
  - "~/.cache"
  - node_modules
before_install: "./build-env.sh"
install:
- npm install
- npm ci
script:
- npm run cypress:headless
- npm test a
- npm run build
deploy:
- provider: pages
  skip_cleanup: true
  github_token: "$github_token"
  local_dir: build
  on:
    branch: release
- provider: surge
  skip_cleanup: true
  project: "./build/"
  domain: a-fathers-lullaby.surge.sh
  on:
    branch: master
branches:
  only:
  - master
  - release